#!/bin/bash

# grubinstall script
# (GNU/General Public License version 3.0)

# Assign output of findmount to variable

TPDEV=$(findmnt -n -o SOURCE /)

# Function to find mountpoint of / and test if on NvME or Sata device

_findmount () {
  if
    [ -z "${TPDEV##*nvme*}" ]; then
    LRDEV=$(findmnt -n -o SOURCE / | cut -c1-12)
  else
    LRDEV=$(findmnt -n -o SOURCE / | cut -c1-8)
  fi
}

# Test for EFI boot and either run grub-install for EFI or move to findmount

if [ -d "/sys/firmware/efi" ]; then
  grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=arafos --recheck
  grub-mkconfig -o /boot/grub/grub.cfg
else
  _findmount
  grub-install --target=i386-pc "${LRDEV}"
  grub-mkconfig -o /boot/grub/grub.cfg
fi


# END
