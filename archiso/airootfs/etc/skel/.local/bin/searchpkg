#!/bin/bash

#####################################
#  @author      : Araf_sk           #
#####################################

# ----------------------------------------For Search Package Universel-------------------------------------
src() {
    if [ -z "$1" ]; then
        echo "Usage: src <keyword>" >&2
        return 1
    fi

    local keyword="$1"
    local installed=""

    # Get list of installed packages (normalized to one per line)
    if command -v pacman >/dev/null; then
        installed=$(pacman -Qq)
    elif command -v apt >/dev/null; then
        installed=$(apt list --installed 2>/dev/null | tail -n +2 | cut -d/ -f1)
    elif command -v dnf >/dev/null; then
        installed=$(rpm -qa --qf '%{NAME}\n' 2>/dev/null)
    elif command -v zypper >/dev/null; then
        installed=$(rpm -qa --qf '%{NAME}\n' 2>/dev/null)
    elif command -v apk >/dev/null; then
        installed=$(apk info)
    else
        echo "Unsupported package manager" >&2
        return 1
    fi

    # Search based on package manager and extract clean names
    if command -v pacman >/dev/null; then
        pacman -Ss "$keyword" 2>/dev/null | awk -F/ 'NF>1 {print $2}' | awk '{print $1}'
    elif command -v apt >/dev/null; then
        apt search "$keyword" 2>/dev/null | grep -E '^[a-zA-Z]' | grep '/' | cut -d/ -f1
    elif command -v dnf >/dev/null; then
        dnf search "$keyword" 2>/dev/null | grep -E '^[a-zA-Z]' | awk '{print $1}' | grep -v '^Last metadata'
    elif command -v zypper >/dev/null; then
        zypper search -t package "$keyword" 2>/dev/null | grep '^|' | awk -F'|' '{gsub(/^[ \t]+|[ \t]+$/, "", $2); print $2}' | grep -v '^$'
    elif command -v apk >/dev/null; then
        apk search "$keyword" 2>/dev/null | cut -d- -f1 | sort -u
    else
        return 1
    fi | \
    # Remove installed packages and empty lines
    grep -vxFf <(echo "$installed") | \
    grep -v "^$"
}
